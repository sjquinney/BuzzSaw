package BuzzSaw::Types; # -*-perl-*-
use strict;
use warnings;

# $Id$
# $Source:$
# $Revision$
# $HeadURL$
# $Date$

our $VERSION = '@LCFG_VERSION@';

use UNIVERSAL::require;

use MooseX::Types -declare => [qw(BuzzSawDB BuzzSawParser BuzzSawFilter)];
use MooseX::Types::Moose qw(HashRef Str);

sub create_new_object {
  my ( $modbase, $modname ) = @_;

  if ( $modname !~ m/^\Q$modbase\E::/ ) {
    $modname = join '::', $modbase, $modname;
  }

  $modname->require or die $UNIVERSAL::require::ERROR;

  return $modname->new();
}

# Parser

role_type BuzzSawParser, { role => 'BuzzSaw::Parser' };

coerce BuzzSawParser,
  from Str,
  via { create_new_object( 'BuzzSaw::Parser', $_ ) };

# Filter

role_type BuzzSawFilter, { role => 'BuzzSaw::Filter' };

coerce BuzzSawFilter,
  from Str,
  via { create_new_object( 'BuzzSaw::Filter', $_ ) };

# DB

class_type BuzzSawDB, { class => 'BuzzSaw::DB' }

coerce BuzzSawDB,
  from Str,
  via { BuzzSaw::DB->new_with_config($_) };

coerce BuzzSawDB,
  from HashRef
  via { BuzzSaw::DB->new($_) };

1;
__END__
